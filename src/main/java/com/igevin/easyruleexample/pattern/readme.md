> 以下两点，不属于规则模式的范畴，但于模式应用有关，再次列出：
> - easy rules 的规则引擎，可以配置为匹配第一条命中规则后就返回，或者每个规则都要匹配计算
> - 每个具体的应用场景下，调用easy rules的规则引擎前，应该先把输入和输出定义好，本文暂未考虑规则输入输出的标准化

# 0. 规则模式设计基础

规则，是条件+行为的组合，不同的条件，搭配不同的行为，可以形成各种具体的规则实例。

规则模式，主要考虑条件的可配置模式。

某个具体场景中的规则，符合某个规则模式，本质上是对该模式的继承，并重写了规则对应的行为

## 规则配置

我们的业务范畴下，规则，最终都落实到字段和值的比较。
- 对单字段做值的比较，输入时仅传值即可，不存在系统内定义字段的限制
- 对多字段做值的比较，需要预先在系统内，对目标字段做定义

对规则字段的定义，支持以下范围的定义：
- 对目标对象内的字段做比较，可以设计系统字典或配置文件，实现字段的映射(a)
- 用不直接来自目标对象的条件做比较，需要在系统（代码）中，预先定义好字段和转换逻辑，及字段值比较逻辑(b)

举例：

(a)类，如当前水位大于阈值5m，预警

(b)类，如上报施工进度时，预计完成时间（系统内根据上报信息自行计算得出）晚于计划完成时间2天，预警


(b)类规则字段定义，往往意味着定制开发

## 行为定义

具体场景中的规则，继承相关的规则模式，自定义规则对应的行为

由于当前实际应用场景较少，行为也不多，暂不考虑行为的抽象性和通用性



# 1. 多个子规则（Multi children Rules）

## 1.1 单字段规则（Single Field Rule）

每个规则实例，表示一个实际的子规则

允许通过集成重写规则对应的行为

### 1.1.1 无序阈值规则（UnorderedSingleValve）

- 可配置阈值
- 可配置比较运算符

1.1.2 有序阈值规则（UnorderedSingleValve）

在"无序阈值规则"的基础上，增加了规则的排序/优先级

（如规则a field > 5, 规则b field > 10, 当输入15时，两条规则都符合，顺序不同，触发的行为也不同）

> 省域空间打分表可用此模式

### 1.1.3 区间规则（RangeValve）

- 配置区间即可

> 省域空间打分表可用此模式


## 1.2 多字段规则（Multi Fields Rule）

暂无具体应用场景，未近一步展开

# 2. 单个复合规则

- 复合规则，是由多个原子规则、通过逻辑运算符（“与”和“或”）组合而成的规则
- 原子规则，是仅包含一个逻辑条件的规则
- 逻辑条件，即字段 + 比较运算符 + 阈值

复合规则虽然只是一个规则，但通常涉及到多个条件，故存在预先在系统内定义规则字段的前置要求

> **考虑到复合规则的自由度和复杂度，复合规则还要补充规范化设计要求，另，综合考虑抽象性和易用性，也可以分解为我们会用到的若干子模式，分别实现。**

<br>

> 建管平台施工进度预警应用此模式的一种子模式，且规则条件使用的字段，不在输入数据中，需要写计算映射相关代码

目前考虑，该模式还要再拆分为实际会用到的几个子模式

To Be Continued...

## 2.1 两层分组规则（TwoLayerGroupedRule）

规则有多个原子规则组合而成，原子规则可以分组，最多支持两层分组，组之间“or”，组内“and”

> 可用于建管平台施工进度预警

# 3. 多个复合规则

目前无涉及，暂不考虑


